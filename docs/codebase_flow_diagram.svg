<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="700" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1000" height="700" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="500" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    LZA Diff Analyzer - Code Flow
  </text>
  
  <!-- Step 1: File Utils -->
  <rect x="50" y="80" width="120" height="60" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="110" y="100" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">File Utils</text>
  <text x="110" y="115" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">file_utils.py</text>
  <text x="110" y="128" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Read diff files</text>
  
  <!-- Arrow 1 -->
  <path d="M 170 110 L 210 110" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 2: Parsing -->
  <rect x="220" y="80" width="120" height="60" rx="10" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="280" y="100" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Parsing</text>
  <text x="280" y="115" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">diff_parser.py</text>
  <text x="280" y="128" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">diff_models.py</text>
  
  <!-- Arrow 2 -->
  <path d="M 340 110 L 380 110" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 3: Base Analyzers -->
  <rect x="390" y="80" width="120" height="60" rx="10" fill="#f39c12" stroke="#d68910" stroke-width="2"/>
  <text x="450" y="100" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Base Analyzers</text>
  <text x="450" y="115" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">base.py</text>
  <text x="450" y="128" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Risk framework</text>
  
  <!-- Arrow 3 -->
  <path d="M 510 110 L 550 110" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 4: Specialist Analyzers -->
  <rect x="560" y="80" width="120" height="60" rx="10" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
  <text x="620" y="95" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Specialist Analyzers</text>
  <text x="620" y="108" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">security_analyzer.py</text>
  <text x="620" y="120" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">network_analyzer.py</text>
  <text x="620" y="132" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">operational_analyzer.py</text>
  
  <!-- Arrow 4 (down) -->
  <path d="M 620 140 L 620 180" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 5: Analysis Engine -->
  <rect x="460" y="190" width="320" height="80" rx="10" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
  <text x="620" y="215" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Analysis Engine</text>
  <text x="620" y="230" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">analysis_engine.py</text>
  <text x="620" y="245" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Orchestrates rule-based + LLM analysis</text>
  <text x="620" y="258" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Coordinates multiple providers (Ollama, OpenAI, Claude)</text>
  
  <!-- LLM Components (side boxes) -->
  <rect x="50" y="190" width="100" height="50" rx="8" fill="#1abc9c" stroke="#16a085" stroke-width="2"/>
  <text x="100" y="210" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="white">LLM Config</text>
  <text x="100" y="225" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">config.py</text>
  
  <rect x="50" y="250" width="100" height="50" rx="8" fill="#1abc9c" stroke="#16a085" stroke-width="2"/>
  <text x="100" y="270" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="white">LLM Base</text>
  <text x="100" y="285" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">base.py</text>
  
  <rect x="50" y="310" width="100" height="50" rx="8" fill="#1abc9c" stroke="#16a085" stroke-width="2"/>
  <text x="100" y="330" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="white">LLM Clients</text>
  <text x="100" y="345" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">ollama_client.py</text>
  
  <!-- Arrows from LLM components -->
  <path d="M 150 215 L 460 215" stroke="#1abc9c" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <path d="M 150 275 L 460 245" stroke="#1abc9c" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  <path d="M 150 335 L 460 265" stroke="#1abc9c" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,5"/>
  
  <!-- Arrow 5 (down) -->
  <path d="M 620 270 L 620 310" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Step 6: Formatters -->
  <rect x="460" y="320" width="320" height="60" rx="10" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
  <text x="620" y="340" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Formatters &amp; Reports</text>
  <text x="620" y="355" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="white">console_formatter.py, json_formatter.py</text>
  <text x="620" y="368" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Generate human-readable reports</text>
  
  <!-- Final Output -->
  <rect x="520" y="420" width="200" height="50" rx="10" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
  <text x="620" y="440" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Final Reports</text>
  <text x="620" y="455" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">JSON, Console, Analysis Files</text>
  
  <!-- Final arrow -->
  <path d="M 620 380 L 620 420" stroke="#34495e" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Interactive AI Assistant Branch -->
  <!-- Arrow from Final Reports to AI Assistant -->
  <path d="M 720 445 L 780 445" stroke="#8e44ad" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- AI Assistant Component -->
  <rect x="790" y="400" width="160" height="90" rx="10" fill="#8e44ad" stroke="#7d3c98" stroke-width="2"/>
  <text x="870" y="420" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="white">AI Assistant</text>
  <text x="870" y="435" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">Interactive Q&amp;A</text>
  <text x="870" y="448" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">• Ask questions about results</text>
  <text x="870" y="460" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">• Get explanations</text>
  <text x="870" y="472" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">• Drill down into specifics</text>
  <text x="870" y="484" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="white">• Contextual recommendations</text>
  
  
  <!-- Connection from AI Assistant back to Analysis Engine (feedback loop) -->
  <path d="M 870 400 Q 870 350 780 230" stroke="#8e44ad" stroke-width="2" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="3,3"/>
  <text x="830" y="320" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="#8e44ad">Follow-up analysis</text>
  
  <!-- Data Flow Labels -->
  <text x="190" y="105" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#7f8c8d">Raw diffs</text>
  <text x="360" y="105" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#7f8c8d">Parsed data</text>
  <text x="530" y="105" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#7f8c8d">Risk findings</text>
  <text x="640" y="165" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#7f8c8d">Specialist analysis</text>
  <text x="640" y="295" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#7f8c8d">Combined assessment</text>
  <text x="640" y="405" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#7f8c8d">Formatted output</text>
  <text x="750" y="440" font-family="Arial, sans-serif" font-size="9" text-anchor="middle" fill="#8e44ad">Interactive mode</text>
  
  <!-- Legend -->
  <rect x="50" y="600" width="400" height="90" rx="5" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1"/>
  <text x="250" y="620" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#2c3e50">Data Flow</text>
  <text x="60" y="640" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">1. File Utils: Read CloudFormation diff files</text>
  <text x="60" y="652" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">2. Parsing: Convert to structured data models</text>
  <text x="60" y="664" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">3. Analysis: Rule-based + LLM risk assessment</text>
  <text x="60" y="676" font-family="Arial, sans-serif" font-size="10" fill="#2c3e50">4. Formatting: Generate reports for human consumption</text>
  <text x="60" y="688" font-family="Arial, sans-serif" font-size="10" fill="#8e44ad">5. AI Assistant: Interactive Q&amp;A about results</text>
  
  <!-- Interactive Features Box -->
  <rect x="480" y="600" width="400" height="90" rx="5" fill="#f4ecf7" stroke="#8e44ad" stroke-width="1"/>
  <text x="680" y="620" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#8e44ad">Interactive AI Features</text>
  <text x="490" y="640" font-family="Arial, sans-serif" font-size="10" fill="#8e44ad">• Context-aware conversations about analysis results</text>
  <text x="490" y="652" font-family="Arial, sans-serif" font-size="10" fill="#8e44ad">• Natural language queries: "What are the high-risk changes?"</text>
  <text x="490" y="664" font-family="Arial, sans-serif" font-size="10" fill="#8e44ad">• Drill-down explanations: "Why is this IAM change risky?"</text>
  <text x="490" y="676" font-family="Arial, sans-serif" font-size="10" fill="#8e44ad">• Follow-up analysis requests and recommendations</text>
  <text x="490" y="688" font-family="Arial, sans-serif" font-size="10" fill="#8e44ad">• Multi-turn conversations with full context retention</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="8" markerHeight="5" refX="7" refY="2.5" orient="auto">
      <polygon points="0 0, 8 2.5, 0 5" fill="#34495e"/>
    </marker>
  </defs>
</svg>