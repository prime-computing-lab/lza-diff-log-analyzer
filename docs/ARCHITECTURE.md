# LZA Diff Analyzer - System Architecture Documentation

## Executive Summary

The LZA Diff Analyzer is a comprehensive Python-based tool designed to analyze AWS Landing Zone Accelerator (LZA) CloudFormation diff logs for potential risks and operational impacts. Built with enterprise-grade requirements in mind, it provides both rule-based and AI-powered analysis capabilities to help cloud administrators make informed decisions about LZA upgrades.

## System Overview

### Purpose
The tool analyzes CloudFormation diff files generated during LZA upgrades to:
- Identify potential security, operational, and compliance risks
- Provide actionable recommendations for safe deployment
- Generate comprehensive reports
- Enable interactive Q&A sessions for deeper analysis

### Key Capabilities
- **Multi-LLM Support**: Integrates with local models (Ollama) and cloud APIs (OpenAI, Anthropic)
- **Rule-Based Analysis**: Comprehensive risk detection using predefined patterns
- **Interactive Sessions**: Natural language Q&A for detailed exploration
- **Reporting**: Professional reports for technical teams
- **Scalable Architecture**: Handles large enterprise LZA deployments (100+ stacks)

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LZA Diff Analyzer                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚     CLI     â”‚    â”‚   WebUI     â”‚    â”‚  API Layer  â”‚         â”‚
â”‚  â”‚  Interface  â”‚    â”‚ğŸ”® (Planned) â”‚    â”‚ğŸ”® (Planned) â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                   â”‚                   â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Application Core                          â”‚    â”‚
â”‚  â”‚                                                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚   Parser    â”‚  â”‚  Analysis   â”‚  â”‚  Formatter  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚   Layer     â”‚  â”‚   Engine    â”‚  â”‚    Layer    â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚         â”‚                 â”‚                 â”‚        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚    File     â”‚ â”‚     Risk      â”‚ â”‚   Report    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Management  â”‚ â”‚  Analyzers    â”‚ â”‚ Generators  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚             â”‚ â”‚               â”‚ â”‚             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚â€¢ Validation â”‚ â”‚â€¢ Security     â”‚ â”‚â€¢ Executive  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚â€¢ Parsing    â”‚ â”‚â€¢ Network      â”‚ â”‚â€¢ Technical  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚â€¢ Storage    â”‚ â”‚â€¢ Operational  â”‚ â”‚â€¢ Compliance â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â€¢ Compliance   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 LLM Integration Layer                   â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚   Ollama    â”‚  â”‚   OpenAI    â”‚  â”‚  Anthropic  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚  Provider   â”‚  â”‚  Provider   â”‚  â”‚  Provider   â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚            Provider Abstraction Layer               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚â€¢ Unified Interface  â€¢ Error Handling  â€¢ Fallbacks  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Data Layer                            â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚ Configurationâ”‚ â”‚    Models   â”‚  â”‚   Output    â”‚    â”‚  â”‚
â”‚  â”‚  â”‚   Manager    â”‚  â”‚   (Pydantic)â”‚  â”‚  Manager    â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Interfaces:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Diff      â”‚    â”‚   Config    â”‚    â”‚   Reports   â”‚
â”‚   Files     â”‚â”€â”€â”€â–¶â”‚   Files     â”‚â”€â”€â”€â–¶â”‚   Output    â”‚
â”‚ (.diff)     â”‚    â”‚ (.yaml)     â”‚    â”‚(.html/.json)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

### Component Interaction Overview

```
â”Œâ”€â”€â”€ COMPONENT INTERACTION ARCHITECTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          USER INTERFACE LAYER                              â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚  â”‚       CLI       â”‚    â”‚   Interactive   â”‚    â”‚   Future Web    â”‚         â”‚ â”‚
â”‚  â”‚  â”‚   Interface     â”‚â—„â”€â”€â–ºâ”‚    Session      â”‚    â”‚       UI        â”‚         â”‚ â”‚
â”‚  â”‚  â”‚   (simple_main.py)     â”‚    â”‚  (simple_session.py)   â”‚    â”‚   ğŸ”® (Planned)   â”‚         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â”‚           â”‚                       â”‚                       â”‚                â”‚ â”‚
â”‚  â”‚           â–¼                       â–¼                       â–¼                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      ORCHESTRATION LAYER                                   â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚           COMPREHENSIVE ANALYSIS ENGINE                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                    (analysis_engine.py)                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€ WORKFLOW COORDINATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  1. Initialize Analysis Session                                     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  2. Load and Validate Configuration                                 â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  3. Coordinate Parallel Analysis Execution                          â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  4. Aggregate and Combine Results                                   â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  5. Generate Comprehensive Assessment                               â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                      â”‚                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                      â–¼                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€ ANALYSIS COORDINATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Rule-Based Analysis â—„â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–º LLM Analysis          â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (Always Executed)            â”‚   â”‚          (Conditional)         â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚           â”‚                   â”‚   â”‚                   â”‚            â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚           â–¼                   â”‚   â”‚                   â–¼            â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€ Risk Analyzers â”€â”€â”€â”€â”€â”     â”‚   â”‚     â”Œâ”€ LLM Providers â”€â”€â”€â”€â”     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ â€¢ SecurityAnalyzer    â”‚     â”‚   â”‚     â”‚ â€¢ Ollama           â”‚     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ â€¢ NetworkAnalyzer     â”‚ â”€â”€â–º â”‚ â— â”‚ â—„â”€â”€ â”‚ â€¢ OpenAI           â”‚     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ â€¢ OperationalAnalyzer â”‚     â”‚   â”‚     â”‚ â€¢ Anthropic        â”‚     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ â€¢ ComplianceAnalyzer  â”‚     â”‚   â”‚     â”‚ â€¢ Fallback Chain   â”‚     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚           â”‚                   â”‚   â”‚                   â”‚            â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚           â–¼                   â”‚   â”‚                   â–¼            â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€ Result Aggregation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚                                                               â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Combine Rule-Based Findings                                â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Integrate LLM Insights                                     â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Generate Combined Assessment                               â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Calculate Confidence Scores                               â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Create ComprehensiveAnalysisResult                         â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚                                                               â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                         PROCESSING LAYERS                                   â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€ DATA LAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€ LLM LAYER â”€â”€â”€â”€â”€â”€â”   â”Œâ”€ OUTPUT LAYER â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚   â”‚                  â”‚   â”‚                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ DiffParser         â”‚   â”‚ â€¢ ProviderFactory â”‚   â”‚ â€¢ ReportGenerator  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ DataModels         â”‚   â”‚ â€¢ ConfigManager   â”‚   â”‚ â€¢ AdminFormatter   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ FileManager        â”‚   â”‚ â€¢ ClientProviders â”‚   â”‚ â€¢ FileSerializer   â”‚   â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Validation         â”‚   â”‚ â€¢ FallbackChains  â”‚   â”‚ â€¢ HTMLTemplates    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚   â”‚                  â”‚   â”‚                    â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Detailed Risk Analyzer Coordination

```
â”Œâ”€â”€â”€ RISK ANALYZER COORDINATION PATTERNS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚  COMPREHENSIVE ANALYSIS ENGINE                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        analyze() Method                                 â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  INPUT: DiffAnalysis (parsed CloudFormation changes)                   â”‚    â”‚
â”‚  â”‚  OUTPUT: ComprehensiveAnalysisResult                                    â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ STEP 1: ANALYZER INITIALIZATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  self.risk_analyzers = [                                            â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      SecurityRiskAnalyzer(),                                        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      NetworkRiskAnalyzer(),                                         â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      OperationalRiskAnalyzer(),                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      ComplianceRiskAnalyzer()                                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  ]                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  Each analyzer implements BaseRiskAnalyzer interface:               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ async def analyze(diff_analysis) -> List[RiskFinding]             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Specialized risk detection logic                                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Risk level classification (LOW/MEDIUM/HIGH/CRITICAL)             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Actionable recommendations                                       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Rollback procedures                                              â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                      â”‚                                  â”‚    â”‚
â”‚  â”‚                                      â–¼                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ STEP 2: PARALLEL RULE-BASED ANALYSIS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  async def _perform_rule_based_analysis():                          â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      SecurityRiskAnalyzer            NetworkRiskAnalyzer           â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚                     â”‚         â”‚                     â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ IAM Permission    â”‚         â”‚ â€¢ Transit Gateway   â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Changes           â”‚         â”‚   Route Changes     â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ KMS Key Policy    â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ â€¢ VPC Configuration â”‚ â—„â”€â”€â”€â”€ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Modifications     â”‚         â”‚   Updates           â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ Cross-Account     â”‚         â”‚ â€¢ Security Group    â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Trust Relations   â”‚         â”‚   Modifications     â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ Encryption        â”‚         â”‚ â€¢ Direct Connect    â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Settings          â”‚         â”‚   Changes           â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚                     â”‚         â”‚                     â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚               â”‚                               â”‚                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚               â–¼                               â–¼                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      OperationalRiskAnalyzer         ComplianceRiskAnalyzer        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚                     â”‚         â”‚                     â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ Resource          â”‚         â”‚ â€¢ SOC2 Type II      â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Deletion Impact   â”‚         â”‚   Requirements      â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ Workload          â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚ â€¢ PCI-DSS           â”‚ â—„â”€â”€â”€â”€ â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Dependencies      â”‚         â”‚   Compliance        â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ Data Loss         â”‚         â”‚ â€¢ GDPR Data         â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Prevention        â”‚         â”‚   Protection        â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â€¢ Scaling and       â”‚         â”‚ â€¢ HIPAA Security    â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚   Performance       â”‚         â”‚   Controls          â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â”‚                     â”‚         â”‚                     â”‚       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚    â”‚
â”‚  â”‚  â”‚               â”‚                               â”‚                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚               â–¼                               â–¼                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€ RESULT COLLECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  findings = []                                                â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  for analyzer in self.risk_analyzers:                        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      try:                                                     â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚          analyzer_findings = await analyzer.analyze(diff)    â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚          findings.extend(analyzer_findings)                  â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      except Exception as e:                                  â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚          log_error(f"Analyzer {analyzer} failed: {e}")       â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚          continue  # Continue with other analyzers            â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  return RuleBasedAnalysisResult(findings=findings)           â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                      â”‚                                  â”‚    â”‚
â”‚  â”‚                                      â–¼                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ STEP 3: LLM ANALYSIS COORDINATION (if enabled) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  async def _perform_llm_analysis():                                 â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€ PROVIDER SELECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  providers_to_try = []                                        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  if preferred_provider:                                       â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      providers_to_try.append(preferred_provider_config)       â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  providers_to_try.extend(fallback_configs)                    â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Order: [Primary] â†’ [Secondary] â†’ [Tertiary]                  â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚         ollama   â†’ openai      â†’ anthropic                    â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                      â”‚                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                      â–¼                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€ CONTEXT PREPARATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  context_summary = self._create_changes_summary(diff_analysis) â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  rule_findings_summary = self._summarize_findings(findings)   â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Combined Context:                                            â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Stack count and resource changes                           â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ IAM modifications summary                                  â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Resource category breakdown                                â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Rule-based findings preview                                â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ LZA version upgrade context                                â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                      â”‚                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                      â–¼                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€ SPECIALIZED PROMPTS (Parallel) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  await asyncio.gather(                                        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      self._llm_overall_assessment(context),                   â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      self._llm_network_analysis(context),                     â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      self._llm_security_analysis(context),                    â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚      self._llm_operational_analysis(context)                  â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  )                                                            â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                                               â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  Each prompt provides:                                        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Business context interpretation                            â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Additional risk identification                             â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Deployment recommendations                                 â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Rollback strategies                                        â”‚  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                      â”‚                                  â”‚    â”‚
â”‚  â”‚                                      â–¼                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ STEP 4: RESULT COMBINATION AND ASSESSMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  combined_result = ComprehensiveAnalysisResult(                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      analysis_id=generate_uuid(),                                   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      timestamp=datetime.now(),                                      â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      diff_analysis=diff_analysis,                                   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      rule_based_analysis=rule_findings,                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      llm_analysis=llm_insights,                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      combined_assessment=self._create_combined_assessment(),        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚      analysis_metadata=self._create_metadata()                      â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  )                                                                  â”‚ â”‚    â”‚
â”‚  â”‚  â”‚                                                                     â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  Key Combination Logic:                                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Merge rule-based and LLM insights                               â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Calculate overall risk level                                    â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Prioritize findings by impact                                   â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Generate actionable recommendations                             â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Create executive summary                                        â”‚ â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Assess analysis confidence                                      â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. Command Line Interface (`src/cli/`)

**Purpose**: User-facing interface providing commands for analysis and interaction

**Key Components**:
- `simple_main.py`: Primary CLI entry point with Click-based commands
  - Comprehensive diff analysis with multiple output formats
  - Built-in interactive AI-powered Q&A session
  - Integrated report generation
  - Configuration management through YAML files
- `analysis_runner.py`: Core analysis workflow coordination

**Dependencies**: 
- Click (CLI framework)
- Rich (Terminal UI)
- Asyncio (Concurrent operations)

### 2. Data Models (`src/models/`)

**Purpose**: Type-safe data structures using Pydantic for validation and serialization

**Key Components**:
- `diff_models.py`: Core data models for CloudFormation changes
  - `StackDiff`: Represents changes in a single stack
  - `ResourceChange`: Individual resource modifications
  - `IAMStatementChange`: IAM policy changes
  - `DiffAnalysis`: Complete analysis results
  - `ComprehensiveAnalysisResult`: Combined rule-based and LLM analysis

**Key Features**:
- **Resource Categorization System**: Automatic classification of AWS resources by service patterns
- **Future-Proof Design**: No hardcoded resource types - automatically adapts to new AWS services
- **Flexible Configuration**: Optional YAML-based categorization rules
- **JSON Serialization**: Proper handling of datetime and enum serialization

### 3. Parsing Layer (`src/parsers/`)

**Purpose**: Extracts structured data from CloudFormation diff files

**Key Components**:
- `diff_parser.py`: Core parser for CloudFormation diff format
  - Template section parsing (description changes)
  - IAM statement changes extraction
  - Resource changes with property-level details
  - Account/region metadata extraction
- `file_utils.py`: File management utilities
  - Directory validation
  - Output structure creation
  - Multi-format serialization (JSON, YAML, HTML)

**Parsing Capabilities**:
- **Multi-Section Parsing**: Handles template, IAM, and resource sections
- **Property-Level Changes**: Detailed tracking of resource property modifications
- **Metadata Extraction**: Account IDs, regions, and stack names from filenames
- **Error Resilience**: Continues processing despite individual file parsing errors

### 4. Analysis Engine (`src/analyzers/`)

**Purpose**: Multi-layered risk analysis combining rule-based and AI-powered insights

#### Core Engine (`analysis_engine.py`)
- **Comprehensive Analysis**: Coordinates rule-based and LLM analysis
- **Provider Management**: Handles LLM fallback chains and error recovery
- **Prompt Engineering**: Specialized prompts for different analysis types
- **Result Combination**: Merges insights from multiple analysis methods

#### Risk Analyzers (`base.py`, `*_analyzer.py`)
- **Security Analyzer**: IAM permissions, encryption, access control risks
- **Network Analyzer**: Connectivity, routing, and network security impacts
- **Operational Analyzer**: Workload impact, data loss prevention, scaling considerations
- **Compliance Analyzer**: Regulatory framework impacts (SOC2, PCI-DSS, GDPR, etc.)

**Analysis Features**:
- **Risk Scoring**: LOW/MEDIUM/HIGH/CRITICAL classification
- **Impact Assessment**: Business and technical impact descriptions
- **Actionable Recommendations**: Specific mitigation steps
- **Rollback Procedures**: Detailed recovery instructions
- **Confidence Scoring**: Assessment reliability metrics

### 5. LLM Integration Layer (`src/llm/`)

**Purpose**: Unified interface for multiple LLM providers with robust error handling

### LLM Provider Selection and Fallback Sequence

```
â”Œâ”€â”€â”€ LLM INTEGRATION SEQUENCE DIAGRAMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚  SEQUENCE 1: SUCCESSFUL LLM ANALYSIS WITH PRIMARY PROVIDER                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  Analysis Engine              LLM Config Manager         Ollama Client  â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ analyze()                  â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ get_llm_config('ollama')   â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LLMConfig(ollama)        â”‚         â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ create_provider(config)     â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ OllamaClient()           â”‚         â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ is_available()              â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶       â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ True   â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ generate(messages)          â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶       â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ HTTP    â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ POST    â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ /api/   â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ generateâ”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ â”€â”€â”€â”€â”€â”€â”€ â–¶    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚ Ollama â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚ Serviceâ”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ â—„â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ Response â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LLM     â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚ Response â”‚    â”‚
â”‚  â”‚       â”‚                            â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ SUCCESS: Continue with      â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â”‚ LLM-enhanced analysis       â”‚                          â”‚         â”‚    â”‚
â”‚  â”‚       â–¼                            â”‚                          â”‚         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â”‚  SEQUENCE 2: FALLBACK CHAIN EXECUTION DUE TO PRIMARY PROVIDER FAILURE          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  Analysis Engine    Config Manager    Ollama Client    OpenAI Client    â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ get_fallback_configs()             â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                 â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [ollama, openai, anthropic]      â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ Try Provider 1: Ollama             â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ is_available()     â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ConnectionError  â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚ (Ollama down)    â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ Log: "Ollama unavailable, trying fallback"           â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ Try Provider 2: OpenAI             â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶        â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ is_available()     â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶        â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ True   â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ generate(messages) â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶        â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ HTTPS   â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ POST    â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ OpenAI  â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ API     â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ â”€â”€â”€â”€â”€â”€â”€ â–¶    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚         â”‚ OpenAI â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ â—„â”€â”€â”€â”€â”€â”€â”€ â”‚ Serviceâ”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ Response â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LLM     â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚ Response â”‚    â”‚
â”‚  â”‚       â”‚                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â”‚       â”‚ SUCCESS: Continue with fallback provider             â”‚          â”‚    â”‚
â”‚  â”‚       â–¼                   â”‚                â”‚                 â”‚          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â”‚  SEQUENCE 3: COMPLETE LLM FAILURE - GRACEFUL DEGRADATION                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  Analysis Engine         All LLM Providers         Rule-Based Analysis  â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ Try all providers in fallback chain               â”‚             â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                           â”‚             â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ All providers failed     â”‚             â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚ (network issues,         â”‚             â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚  API quotas exceeded,    â”‚             â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚  service unavailable)    â”‚             â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ Log: "LLM analysis failed, continuing with rule-based only"     â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ continue_with_rule_based_analysis()               â”‚             â”‚    â”‚
â”‚  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â–¶             â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Rule-Based â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚ Findings   â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ create_analysis_result(rule_findings, llm_insights=None)        â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ analysis_metadata.llm_enhancement = "FAILED"      â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ analysis_metadata.confidence_level = "MEDIUM"     â”‚             â”‚    â”‚
â”‚  â”‚       â”‚                        â”‚                          â”‚             â”‚    â”‚
â”‚  â”‚       â”‚ SUCCESS: Analysis completes with reduced confidence but full    â”‚    â”‚
â”‚  â”‚       â”‚          rule-based assessment available          â”‚             â”‚    â”‚
â”‚  â”‚       â–¼                        â”‚                          â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### LLM Error Handling and Recovery Patterns

```
â”Œâ”€â”€â”€ LLM ERROR HANDLING PATTERNS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚  ERROR TYPE 1: CONNECTION AND TIMEOUT ERRORS                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  try:                                                                   â”‚    â”‚
â”‚  â”‚      response = await client.generate(                                 â”‚    â”‚
â”‚  â”‚          messages=messages,                                             â”‚    â”‚
â”‚  â”‚          timeout=aiohttp.ClientTimeout(total=30)                       â”‚    â”‚
â”‚  â”‚      )                                                                  â”‚    â”‚
â”‚  â”‚  except asyncio.TimeoutError:                                          â”‚    â”‚
â”‚  â”‚      logger.warning(f"LLM request timeout for {provider}")             â”‚    â”‚
â”‚  â”‚      raise LLMError(                                                   â”‚    â”‚
â”‚  â”‚          f"Request timeout for {provider}",                            â”‚    â”‚
â”‚  â”‚          provider=provider,                                             â”‚    â”‚
â”‚  â”‚          error_type=ErrorType.TIMEOUT                                  â”‚    â”‚
â”‚  â”‚      )                                                                  â”‚    â”‚
â”‚  â”‚  except aiohttp.ClientError as e:                                      â”‚    â”‚
â”‚  â”‚      logger.warning(f"LLM connection error for {provider}: {e}")       â”‚    â”‚
â”‚  â”‚      raise LLMError(                                                   â”‚    â”‚
â”‚  â”‚          f"Connection failed for {provider}",                          â”‚    â”‚
â”‚  â”‚          provider=provider,                                             â”‚    â”‚
â”‚  â”‚          error_type=ErrorType.CONNECTION                               â”‚    â”‚
â”‚  â”‚      )                                                                  â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  RECOVERY ACTION: Try next provider in fallback chain                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â”‚  ERROR TYPE 2: AUTHENTICATION AND AUTHORIZATION ERRORS                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  if response.status == 401:                                            â”‚    â”‚
â”‚  â”‚      logger.error(f"Authentication failed for {provider}")             â”‚    â”‚
â”‚  â”‚      raise LLMError(                                                   â”‚    â”‚
â”‚  â”‚          f"Invalid API key for {provider}",                            â”‚    â”‚
â”‚  â”‚          provider=provider,                                             â”‚    â”‚
â”‚  â”‚          error_type=ErrorType.AUTHENTICATION                           â”‚    â”‚
â”‚  â”‚      )                                                                  â”‚    â”‚
â”‚  â”‚  elif response.status == 403:                                          â”‚    â”‚
â”‚  â”‚      logger.error(f"Authorization failed for {provider}")              â”‚    â”‚
â”‚  â”‚      raise LLMError(                                                   â”‚    â”‚
â”‚  â”‚          f"Insufficient permissions for {provider}",                   â”‚    â”‚
â”‚  â”‚          provider=provider,                                             â”‚    â”‚
â”‚  â”‚          error_type=ErrorType.AUTHORIZATION                            â”‚    â”‚
â”‚  â”‚      )                                                                  â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  RECOVERY ACTION: Skip this provider, try next in chain                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â”‚  ERROR TYPE 3: RATE LIMITING AND QUOTA ERRORS                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  if response.status == 429:                                            â”‚    â”‚
â”‚  â”‚      retry_after = response.headers.get('Retry-After', '60')           â”‚    â”‚
â”‚  â”‚      logger.warning(f"Rate limited by {provider}, retry after {retry_after}s") â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚      if attempt < max_retries:                                          â”‚    â”‚
â”‚  â”‚          await asyncio.sleep(int(retry_after))                         â”‚    â”‚
â”‚  â”‚          return await self._retry_request(messages, attempt + 1)       â”‚    â”‚
â”‚  â”‚      else:                                                              â”‚    â”‚
â”‚  â”‚          raise LLMError(                                               â”‚    â”‚
â”‚  â”‚              f"Rate limit exceeded for {provider}",                    â”‚    â”‚
â”‚  â”‚              provider=provider,                                         â”‚    â”‚
â”‚  â”‚              error_type=ErrorType.RATE_LIMIT                           â”‚    â”‚
â”‚  â”‚          )                                                              â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  RECOVERY ACTION: Exponential backoff retry, then fallback             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â”‚  ERROR TYPE 4: MODEL AND CONTENT ERRORS                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  if response.status == 400:                                            â”‚    â”‚
â”‚  â”‚      error_data = await response.json()                                â”‚    â”‚
â”‚  â”‚      error_msg = error_data.get('error', {}).get('message', 'Unknown') â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚      if 'content filter' in error_msg.lower():                         â”‚    â”‚
â”‚  â”‚          logger.warning(f"Content filtered by {provider}")             â”‚    â”‚
â”‚  â”‚          # Try with sanitized prompt                                    â”‚    â”‚
â”‚  â”‚          sanitized_messages = self._sanitize_messages(messages)        â”‚    â”‚
â”‚  â”‚          return await self.generate(sanitized_messages)                â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚      elif 'model not found' in error_msg.lower():                      â”‚    â”‚
â”‚  â”‚          logger.error(f"Model not available on {provider}")            â”‚    â”‚
â”‚  â”‚          raise LLMError(                                               â”‚    â”‚
â”‚  â”‚              f"Model unavailable for {provider}",                      â”‚    â”‚
â”‚  â”‚              provider=provider,                                         â”‚    â”‚
â”‚  â”‚              error_type=ErrorType.MODEL_ERROR                          â”‚    â”‚
â”‚  â”‚          )                                                              â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  RECOVERY ACTION: Sanitize content and retry, or try next provider     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                                  â”‚
â”‚  COMPREHENSIVE ERROR RECOVERY FLOW                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚  async def _perform_llm_analysis_with_recovery():                       â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚      providers_tried = []                                              â”‚    â”‚
â”‚  â”‚      last_error = None                                                 â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚      for provider_config in self.get_provider_chain():                 â”‚    â”‚
â”‚  â”‚          try:                                                           â”‚    â”‚
â”‚  â”‚              logger.info(f"Attempting LLM analysis with {provider}")   â”‚    â”‚
â”‚  â”‚              provider = self.factory.create_provider(provider_config)  â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚              if not provider.is_available():                           â”‚    â”‚
â”‚  â”‚                  providers_tried.append(f"{provider.name}:unavailable")â”‚    â”‚
â”‚  â”‚                  continue                                               â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚              result = await provider.generate(messages)                â”‚    â”‚
â”‚  â”‚              logger.info(f"LLM analysis successful with {provider}")   â”‚    â”‚
â”‚  â”‚              return result                                              â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚          except LLMError as e:                                         â”‚    â”‚
â”‚  â”‚              providers_tried.append(f"{provider.name}:{e.error_type}") â”‚    â”‚
â”‚  â”‚              last_error = e                                             â”‚    â”‚
â”‚  â”‚              logger.warning(f"Provider {provider} failed: {e}")        â”‚    â”‚
â”‚  â”‚              continue                                                   â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚      # All providers failed                                            â”‚    â”‚
â”‚  â”‚      logger.error(f"All LLM providers failed: {providers_tried}")      â”‚    â”‚
â”‚  â”‚      self.analysis_metadata.llm_provider_attempts = providers_tried    â”‚    â”‚
â”‚  â”‚      self.analysis_metadata.llm_enhancement = "FAILED"                 â”‚    â”‚
â”‚  â”‚      self.analysis_metadata.confidence_level = "MEDIUM"                â”‚    â”‚
â”‚  â”‚                                                                         â”‚    â”‚
â”‚  â”‚      return None  # Graceful degradation to rule-based only            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Components**:
- `base.py`: Abstract provider interface and factory pattern
- `config.py`: Configuration management with fallback chains
- `ollama_client.py`: Local model integration via Ollama

**LLM Features**:
- **Multi-Provider Support**: Unified interface with provider abstraction
  - âœ… **Ollama**: Fully implemented (`ollama_client.py`)
  - âœ… **OpenAI**: Fully implemented (requires API key)
  - âœ… **Anthropic**: Fully implemented (requires API key)
- **Fallback Chains**: Automatic provider switching on failures
- **Async Operations**: Non-blocking LLM calls with timeout handling
- **Configuration Management**: YAML-based provider settings
- **Error Recovery**: Graceful degradation to rule-based analysis
- **Caching & Optimization**: Skip comprehensive analysis when recent results exist

**Current Implementation Status**:
- **Ollama Integration**: Production ready with full error handling
- **OpenAI Integration**: Production ready (requires API key configuration)
- **Anthropic Integration**: Production ready (requires API key configuration)
- **Provider Factory**: Complete with unified interface pattern
- **Fallback System**: Implemented and tested across all providers

### 6. Reporting & Formatting (`src/reports/`, `src/formatters/`)

**Purpose**: Generate stakeholder-appropriate outputs

#### Report Generator (`report_generator.py`)
- **Executive Reports**: Business-focused summaries for decision makers
- **Technical Reports**: Detailed findings for engineering teams
- **Risk Matrix Reports**: Visual risk assessment matrices
- **Compliance Reports**: Regulatory impact assessments
- **HTML Generation**: Professional styling with Jinja2 templates

#### Admin-Friendly Formatter (`admin_friendly.py`)
- **Cloud Administrator Focus**: Simplified, actionable summaries
- **Risk Prioritization**: Key concerns requiring immediate attention
- **Action Checklists**: Immediate next steps
- **Context Explanation**: Why findings matter and what they mean

### 7. Interactive Session (`src/interactive/`)

**Purpose**: Natural language Q&A interface for detailed analysis exploration

**Key Components**:
- `simple_session.py`: Streamlined interactive session implementation

**Key Features**:
- **Context-Aware**: Uses analysis results to provide informed responses
- **Rule-Based Fallback**: Functions without LLM for basic guidance
- **Specialized Knowledge**: LZA-specific expertise and common patterns
- **Session Management**: Proper resource cleanup and error handling
- **Integrated Workflow**: Seamlessly transitions from analysis to interactive mode

## Data Flow Architecture

### Complete System Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LZA Diff Analyzer - Complete Data Flow                â”‚
â”‚                                                                                 â”‚
â”‚  INPUT STAGE                PROCESSING STAGE                OUTPUT STAGE        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   .diff     â”‚            â”‚                 â”‚             â”‚   Reports     â”‚  â”‚
â”‚  â”‚   Files     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Analysis       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   & Outputs   â”‚  â”‚
â”‚  â”‚             â”‚            â”‚  Pipeline       â”‚             â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Config     â”‚            â”‚                 â”‚             â”‚  Interactive  â”‚  â”‚
â”‚  â”‚  Files      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   LLM Layer     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Sessions    â”‚  â”‚
â”‚  â”‚  (.yaml)    â”‚            â”‚                 â”‚             â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Detailed Input Processing Flow

```
â”Œâ”€â”€â”€ INPUT VALIDATION & PARSING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚  CloudFormation Diff Files (.diff)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  AWSAccelerator-SecurityStack-145023093216.diff â”‚                           â”‚
â”‚  â”‚  AWSAccelerator-NetworkStack-238611950256.diff  â”‚                           â”‚
â”‚  â”‚  AWSAccelerator-IAMStack-504706990227.diff      â”‚ â”€â”€â”€â”                      â”‚
â”‚  â”‚  ... (up to 100+ stack files)                   â”‚    â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                      â”‚
â”‚                                                         â”‚                      â”‚
â”‚                                                         â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€ FILE VALIDATION (file_utils.py) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Check file extensions (.diff required)                                   â”‚ â”‚
â”‚  â”‚  â€¢ Validate directory structure                                             â”‚ â”‚
â”‚  â”‚  â€¢ Verify file readability and size limits                                 â”‚ â”‚
â”‚  â”‚  â€¢ Extract metadata (account ID, region, stack name)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€ DIFF PARSER (diff_parser.py) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  TEMPLATE SECTION PARSING:                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ Description Changes    â†’ Version Detection (LZA 1.10.0 â†’ 1.12.1)      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Parameter Updates      â†’ SSM Parameter Modifications                   â”‚ â”‚
â”‚  â”‚  â””â”€ Metadata Extraction    â†’ Stack Context Information                     â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  IAM STATEMENT PARSING:                                                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ Table Format Processing   â”‚ + â”‚ Resource â”‚ Effect â”‚ Action â”‚ Principal â”‚ â”‚
â”‚  â”‚  â”œâ”€ Change Type Detection (ADD/MODIFY/DELETE)                              â”‚ â”‚
â”‚  â”‚  â”œâ”€ Policy Statement Extraction                                            â”‚ â”‚
â”‚  â”‚  â””â”€ Cross-Account Role Analysis                                            â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  RESOURCE SECTION PARSING:                                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ Resource Type Identification (AWS::IAM::Role, AWS::EC2::VPC, etc.)     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Property-Level Change Detection                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Resource Dependency Mapping                                            â”‚ â”‚
â”‚  â”‚  â””â”€ Change Impact Assessment                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€ DATA MODEL CREATION (diff_models.py) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  PYDANTIC MODEL INSTANTIATION:                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  DiffAnalysis                                                       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ timestamp: datetime                                             â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ stack_diffs: List[StackDiff]                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ total_stacks: int                                               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€ total_resources_changed: int                                    â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ total_iam_changes: int                                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    StackDiff                                                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ stack_name: str                                               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ resource_changes: List[ResourceChange]                        â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ iam_statement_changes: List[IAMStatementChange]               â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ account_id: Optional[str]                                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ region: Optional[str]                                         â”‚   â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      ResourceChange                                                 â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      â”œâ”€ logical_id: str                                             â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      â”œâ”€ resource_type: str                                          â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      â”œâ”€ change_type: ChangeType                                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      â”œâ”€ property_changes: List[PropertyChange]                      â”‚   â”‚ â”‚
â”‚  â”‚  â”‚      â””â”€ parsed_resource_category: ResourceCategory (auto-assigned)   â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  AUTOMATIC RESOURCE CATEGORIZATION:                                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Service Pattern Matching (AWS::IAM::* â†’ IAM_RESOURCES)                 â”‚ â”‚
â”‚  â”‚  â”œâ”€ Security Classification (KMS, SecretsManager â†’ SECURITY_RESOURCES)     â”‚ â”‚
â”‚  â”‚  â”œâ”€ Network Resource Detection (VPC, TGW â†’ NETWORK_RESOURCES)              â”‚ â”‚
â”‚  â”‚  â””â”€ Future-Proof Pattern System (adapts to new AWS services)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Comprehensive Analysis Processing Flow

```
â”Œâ”€â”€â”€ ANALYSIS ENGINE COORDINATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚  DiffAnalysis (Parsed & Validated Data)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ 74 CloudFormation Stacks                                            â”‚    â”‚
â”‚  â”‚  â€¢ 225 Resource Changes                                                 â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ 156 IAM Resources                                                â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ 34 Network Resources                                             â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ 23 Security Resources                                            â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ 12 Other Resources                                               â”‚    â”‚
â”‚  â”‚  â€¢ 462 IAM Statement Changes                                            â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ 258 Policy Modifications                                         â”‚    â”‚
â”‚  â”‚  â”‚  â”œâ”€ 134 Role Updates                                                 â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€ 70 Trust Relationship Changes                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€ COMPREHENSIVE ANALYSIS ENGINE (analysis_engine.py) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ PARALLEL ANALYSIS EXECUTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  RULE-BASED ANALYSIS (Always Executed)                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Security Risk  â”‚    â”‚  Network Risk   â”‚    â”‚ Operational Riskâ”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    Analyzer     â”‚    â”‚    Analyzer     â”‚    â”‚    Analyzer     â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ IAM Changes   â”‚    â”‚ â€¢ TGW Routes    â”‚    â”‚ â€¢ Data Loss     â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ KMS Policies  â”‚    â”‚ â€¢ VPC Configs   â”‚    â”‚ â€¢ Dependencies  â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Access Rights â”‚    â”‚ â€¢ Cross-Account â”‚    â”‚ â€¢ Workload Impactâ”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Encryption    â”‚    â”‚ â€¢ Direct Connectâ”‚    â”‚ â€¢ Scaling       â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                       â”‚                       â”‚            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚           â–¼                       â–¼                       â–¼            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Compliance Risk â”‚     â—„â”€â”€â”€â”€â”€â”€ Risk Finding Aggregation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    Analyzer     â”‚                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                 â”‚     Each analyzer returns:                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ SOC2 Impact   â”‚     â€¢ List[RiskFinding]                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ PCI-DSS       â”‚     â€¢ Risk Level (LOW/MEDIUM/HIGH/CRITICAL)       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ GDPR          â”‚     â€¢ Recommendations                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ HIPAA         â”‚     â€¢ Rollback Steps                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ ISO27001      â”‚     â€¢ Confidence Score                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                      â”‚                                      â”‚ â”‚
â”‚  â”‚                                      â–¼                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ LLM ANALYSIS (Conditional) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  LLM PROVIDER SELECTION & FALLBACK CHAIN                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  1. Primary Provider (from config: ollama/openai/anthropic)        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     â”œâ”€ Check availability (health check)                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     â”œâ”€ Verify configuration (API keys, endpoints)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     â””â”€ Test connectivity                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  2. Fallback Chain Execution                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     â”œâ”€ If primary fails â†’ try secondary provider                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     â”œâ”€ If secondary fails â†’ try tertiary provider                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     â””â”€ If all fail â†’ continue with rule-based analysis only         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                      â”‚                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                      â–¼                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  CONTEXT PREPARATION & PROMPT ENGINEERING                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Context Summary Generation:                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Change statistics and categorization                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Rule-based findings summary                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Risk level distributions                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ LZA version upgrade context                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Specialized Prompts (Parallel Execution):                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Overall Assessment â†’ Enterprise-wide impact analysis            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Network Impact â†’ Hub-spoke, TGW, Direct Connect analysis        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Security Impact â†’ Access control, encryption analysis           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Operational Readiness â†’ Deployment guidance, rollback plans     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                      â”‚                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                      â–¼                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  LLM RESPONSE PROCESSING & INTEGRATION                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Parse and validate LLM responses                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Extract actionable insights and recommendations                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Identify additional risks not caught by rule-based analysis     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Generate business context and impact explanations               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Create deployment and rollback guidance                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                      â”‚                                      â”‚ â”‚
â”‚  â”‚                                      â–¼                                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ ANALYSIS RESULT COMBINATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  ComprehensiveAnalysisResult Creation:                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Rule-Based Findings:                                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Security: 45 findings (3 CRITICAL, 12 HIGH, 30 MEDIUM)         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Network: 23 findings (1 HIGH, 22 MEDIUM)                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Operational: 34 findings (2 HIGH, 32 MEDIUM)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Compliance: 12 findings (12 MEDIUM)                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  LLM Insights (if available):                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Overall Assessment: "Standard LZA upgrade pattern"              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Network Impact: "Hub-spoke connectivity maintained"             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Security Impact: "Cross-account roles require validation"       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Operational Readiness: "Test IAM in non-prod first"             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Combined Assessment:                                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Overall Risk Level: MEDIUM                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Key Concerns: IAM permission changes, cross-account access      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Immediate Actions: Test in non-prod, validate IAM changes       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Analysis Confidence: HIGH (rule-based + LLM validation)         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Metadata & Statistics:                                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Analysis Duration: 45.2 seconds                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ LLM Provider Used: ollama (qwen3:30b-a3b)                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Rule-Based Findings: 114 total                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ LLM Enhancement: SUCCESS                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Enhanced Output Generation Flow

```
â”Œâ”€â”€â”€ OUTPUT GENERATION & FORMATTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                  â”‚
â”‚  ComprehensiveAnalysisResult (Complete Analysis Data)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â€¢ Analysis Metadata (timestamp, duration, confidence)                 â”‚    â”‚
â”‚  â”‚  â€¢ Rule-Based Findings (114 total across 4 risk categories)            â”‚    â”‚
â”‚  â”‚  â€¢ LLM Insights (4 specialized assessments)                            â”‚    â”‚
â”‚  â”‚  â€¢ Combined Assessment (overall risk level, key concerns)              â”‚    â”‚
â”‚  â”‚  â€¢ Statistics (stacks analyzed, resources changed, IAM changes)        â”‚    â”‚
â”‚  â”‚  â€¢ Recommendations (immediate actions, testing guidance)               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€ OUTPUT FORMAT SELECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  User-Specified Format (CLI Options)                                       â”‚ â”‚
â”‚  â”‚  â”œâ”€ --format json    â†’ Machine-readable output                             â”‚ â”‚
â”‚  â”‚  â”œâ”€ --format yaml    â†’ Human-readable structured output                    â”‚ â”‚
â”‚  â”‚  â”œâ”€ --format html    â†’ Basic HTML output                                   â”‚ â”‚
â”‚  â”‚  â”œâ”€ --generate-reports â†’ Comprehensive enterprise reports                  â”‚ â”‚
â”‚  â”‚  â””â”€ Default: admin-friendly console output                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€ PARALLEL OUTPUT GENERATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚  â”‚  JSON/YAML      â”‚    â”‚ Admin-Friendly  â”‚    â”‚  Interactive    â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ Serialization   â”‚    â”‚    Summary      â”‚    â”‚   Session       â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ (file_utils.py) â”‚    â”‚(admin_friendly) â”‚    â”‚  (simple_session.py)   â”‚         â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Datetime      â”‚    â”‚ â€¢ Executive     â”‚    â”‚ â€¢ Context-Aware â”‚         â”‚ â”‚
â”‚  â”‚  â”‚   Handling      â”‚    â”‚   Summary       â”‚    â”‚   Q&A           â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Enum          â”‚    â”‚ â€¢ Key Concerns  â”‚    â”‚ â€¢ LLM-Powered   â”‚         â”‚ â”‚
â”‚  â”‚  â”‚   Serialization â”‚    â”‚ â€¢ Action Items  â”‚    â”‚   Responses     â”‚         â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Custom        â”‚    â”‚ â€¢ LZA Context   â”‚    â”‚ â€¢ Rule-Based    â”‚         â”‚ â”‚
â”‚  â”‚  â”‚   Encoders      â”‚    â”‚ â€¢ Risk Priority â”‚    â”‚   Fallback      â”‚         â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â”‚           â”‚                       â”‚                       â”‚                â”‚ â”‚
â”‚  â”‚           â–¼                       â–¼                       â–¼                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€ ENTERPRISE REPORTS (report_generator.py) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  HTML Report Generation with Jinja2 Templates:                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Executive     â”‚    â”‚    Technical    â”‚    â”‚   Risk Matrix   â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    Summary      â”‚    â”‚     Report      â”‚    â”‚     Report      â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Target: C-Level â”‚    â”‚ Target: DevOps  â”‚    â”‚ Target: SecOps  â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Business      â”‚    â”‚ â€¢ Detailed      â”‚    â”‚ â€¢ Visual Risk   â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Impact        â”‚    â”‚   Findings      â”‚    â”‚   Assessment    â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ High-Level    â”‚    â”‚ â€¢ Technical     â”‚    â”‚ â€¢ Compliance    â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Risks         â”‚    â”‚   Details       â”‚    â”‚   Framework     â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Go/No-Go      â”‚    â”‚ â€¢ Code Changes  â”‚    â”‚   Mapping       â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Decision      â”‚    â”‚ â€¢ Rollback      â”‚    â”‚ â€¢ Risk Matrix   â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Budget Impact â”‚    â”‚   Procedures    â”‚    â”‚   Visualization â”‚     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚           â”‚                       â”‚                       â”‚            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚           â–¼                       â–¼                       â–¼            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Compliance    â”‚    â—„â”€â”€â”€â”€â”€â”€ Professional HTML Styling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚     Report      â”‚                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                 â”‚    â€¢ Corporate CSS themes                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Target: Audit   â”‚    â€¢ Responsive design                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ SOC2 Impact   â”‚    â€¢ Print-friendly layouts                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ PCI-DSS       â”‚    â€¢ Auto-escaping for security                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ GDPR          â”‚    â€¢ Professional branding                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ HIPAA         â”‚    â€¢ Interactive elements (future)                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ ISO27001      â”‚    â€¢ Export capabilities                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                                          â”‚
â”‚                                      â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€ OUTPUT DELIVERY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  File System Output:                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚  â”‚  â”‚  output/                                                                â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ analysis/                                                          â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ diff_analysis.json                 (Machine processing)       â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ comprehensive_analysis.json        (Complete results)         â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ analysis_summary.yaml               (Human readable)          â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ reports/                                                           â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ executive_summary.html              (C-Level audience)        â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ technical_report.html               (Engineering teams)       â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ risk_matrix.html                    (Security teams)          â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ compliance_report.html              (Audit teams)             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ full_report.html                    (Complete analysis)       â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ logs/                                                             â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€â”€ analysis.log                        (Process logging)         â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ llm_interactions.log                (LLM request/response)    â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€ temp/                                                             â”‚ â”‚
â”‚  â”‚  â”‚      â””â”€â”€ intermediate_results/               (Debug & troubleshooting) â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  Console Output (Real-time):                                               â”‚ â”‚
â”‚  â”‚  â”œâ”€ Rich-formatted progress bars and status updates                        â”‚ â”‚
â”‚  â”‚  â”œâ”€ Color-coded risk level indicators                                      â”‚ â”‚
â”‚  â”‚  â”œâ”€ Executive summary with immediate action items                          â”‚ â”‚
â”‚  â”‚  â””â”€ Interactive prompts for session continuation                           â”‚ â”‚
â”‚  â”‚                                                                             â”‚ â”‚
â”‚  â”‚  Interactive Session (Optional):                                           â”‚ â”‚
â”‚  â”‚  â”œâ”€ Natural language Q&A interface                                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ Context-aware responses using analysis results                         â”‚ â”‚
â”‚  â”‚  â”œâ”€ LLM-powered or rule-based fallback responses                           â”‚ â”‚
â”‚  â”‚  â””â”€ Session transcripts saved for reference                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Architecture

### Input Validation
- **File Type Validation**: Only processes .diff files
- **Content Sanitization**: Prevents malicious input injection
- **Path Validation**: Ensures file paths are within expected directories
- **Size Limits**: Protects against resource exhaustion

### LLM Security
- **API Key Management**: Environment variable-based configuration
- **Request Sanitization**: Prevents prompt injection attacks
- **Rate Limiting**: Configurable timeouts and retry policies
- **Error Isolation**: LLM failures don't compromise rule-based analysis

### Output Security
- **Template Sanitization**: Jinja2 auto-escaping for HTML reports
- **Path Traversal Prevention**: Validates output file paths
- **Configuration Validation**: YAML parsing with safe loaders

## Performance Characteristics

### Scalability
- **Large Deployments**: Tested with 74 stacks, 225 resources, 462 IAM changes
- **Memory Efficiency**: Streaming parsing for large diff files
- **Concurrent Processing**: Async/await architecture for LLM calls
- **Incremental Analysis**: Can process individual stacks independently

### Performance Optimizations
- **Provider Fallback**: Minimizes LLM call failures
- **Caching**: Configuration caching to reduce file I/O
- **Batch Processing**: Groups similar analysis operations
- **Error Recovery**: Continues processing despite individual failures

## Configuration Management

### LLM Configuration (`config/llm_config.yaml`)
```yaml
default_provider: ollama
fallback_chain: [ollama, openai, anthropic]
providers:
  ollama:
    model: "qwen3:30b-a3b"  # Current production model
    temperature: 0.1
    max_tokens: 12288
  # Additional provider configurations...
```

### Resource Categorization (Optional)
- **Service Patterns**: Regex-based resource classification
- **Custom Mappings**: Override default categorizations
- **Extensible**: Add new categories without code changes

## Error Handling & Resilience

### Graceful Degradation
- **LLM Unavailable**: Falls back to rule-based analysis
- **Parsing Errors**: Continues with remaining files
- **Configuration Issues**: Uses sensible defaults
- **Network Failures**: Implements retry logic with exponential backoff

### Error Recovery
- **Provider Failures**: Automatic fallback to next LLM provider
- **Partial Analysis**: Returns available results even with some failures
- **Resource Cleanup**: Ensures proper cleanup of async resources
- **Detailed Logging**: Comprehensive error reporting for debugging

## Extension Points

### Adding New Analyzers
1. Inherit from `BaseRiskAnalyzer`
2. Implement analysis logic
3. Register with `RiskAnalysisEngine`

### Supporting New LLM Providers
1. Inherit from `BaseLLMProvider`
2. Implement provider-specific communication
3. Add configuration schema
4. Register with `LLMProviderFactory`

### Custom Report Formats
1. Create new Jinja2 templates
2. Add generation methods to `EnterpriseReportGenerator`
3. Update CLI options

### New Resource Types
- **Automatic Support**: Uses service pattern matching
- **Custom Categories**: Add patterns to configuration
- **No Code Changes**: Configuration-driven categorization

## Dependencies & Technology Stack

### Core Dependencies
- **Python 3.10+**: Modern Python features and type hints
- **Pydantic 2.0+**: Data validation and serialization
- **Click 8.1+**: Command-line interface framework
- **Rich 13.0+**: Terminal UI and progress indication
- **Jinja2 3.1+**: Template engine for report generation
- **PyYAML 6.0+**: Configuration file parsing
- **aiohttp 3.8+**: Async HTTP client for LLM APIs

### Optional Dependencies
- **Ollama SDK**: Local LLM integration
- **OpenAI SDK**: Cloud LLM integration
- **Anthropic SDK**: Claude API integration

### Development Dependencies
- **pytest**: Testing framework
- **pytest-asyncio**: Async test support
- **mypy**: Static type checking
- **black**: Code formatting
- **isort**: Import sorting

## Deployment Considerations

### Environment Requirements
- **Python 3.10+**: Required for modern async features
- **Memory**: Minimum 2GB RAM for large analyses
- **Storage**: Configurable output directory
- **Network**: Optional for cloud LLM providers

### Installation Options
- **UV Package Manager**: Recommended for fast dependency resolution
- **Standard pip**: Alternative installation method
- **Development Setup**: Additional tools for code contribution

### Configuration Best Practices
- **Environment Variables**: API keys and sensitive configuration
- **YAML Files**: Non-sensitive configuration management
- **Default Fallbacks**: Ensure functionality without configuration
- **Validation**: Comprehensive configuration validation

This architecture provides a robust, scalable foundation for analyzing LZA deployments while maintaining flexibility for future enhancements and enterprise requirements.